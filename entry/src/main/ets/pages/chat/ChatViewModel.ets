/**
 * @fileName : ChatViewModel.ets
 * @author : @cxy
 * @date : 2025/8/31
 * @description : èŠå¤©åˆ—è¡¨æ•°æ®ç®¡ç†
 */

import { RefreshDataSource, RefreshController } from '@cxy/refreshlist'
import { ItemModel } from '../../models/ItemModel'

export class ChatViewModel {
  dataSource: RefreshDataSource = new RefreshDataSource()
  controller: RefreshController = new RefreshController()

  refresh(): void {
    this.requestPage()
  }

  requestPage() {
    // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
    setTimeout(() => {
      const data = this.generateData()
      this.dataSource.deleteAll()
      this.dataSource.pushDataArray(data)
      this.controller.finishRefresh()
    }, 800)
  }

  private generateData(): ItemModel[] {
    const names = [
      'å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å',
      'éƒ‘åä¸€', 'ç‹åäºŒ', 'å†¯åä¸‰', 'é™ˆåå››', 'è¤šåäº”', 'å«åå…­',
      'è’‹åä¸ƒ', 'æ²ˆåå…«', 'éŸ©åä¹', 'æ¨äºŒå'
    ]

    const lastMessages = [
      'ä½ å¥½ï¼Œæœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ', 'ä»Šå¤©å¤©æ°”ä¸é”™å‘¢', 'æ™šä¸Šä¸€èµ·åƒé¥­å§',
      'å·¥ä½œé¡ºåˆ©å—ï¼Ÿ', 'å‘¨æœ«æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ', 'è¿™ä¸ªé¡¹ç›®è¿›å±•å¦‚ä½•ï¼Ÿ',
      'è°¢è°¢ä½ çš„å¸®åŠ©', 'æ˜å¤©è§é¢èŠ', 'å‘ä¸ªä½ç½®ç»™æˆ‘',
      'æ”¶åˆ°ï¼Œé©¬ä¸Šè¿‡å»', 'å¥½çš„ï¼Œæ²¡é—®é¢˜', 'è¾›è‹¦äº†',
      '[å›¾ç‰‡]', '[è¯­éŸ³]', '[è§†é¢‘é€šè¯]',
      'å“ˆå“ˆå“ˆ', 'ğŸ‘', 'ğŸ‰'
    ]

    const messageTypes = ['text', 'image', 'voice', 'video']

    const timeFormats = [
      'åˆšåˆš', '1åˆ†é’Ÿå‰', '5åˆ†é’Ÿå‰', '10åˆ†é’Ÿå‰', '30åˆ†é’Ÿå‰',
      '1å°æ—¶å‰', '2å°æ—¶å‰', 'æ˜¨å¤©', 'å‰å¤©', 'å‘¨ä¸€', 'å‘¨äºŒ'
    ]

    const count = names.length
    const result: ItemModel[] = []
    for (let index = 0; index < count; index++) {
      const globalIndex = index
      const isOnline = Math.random() > 0.3 // 70%åœ¨çº¿æ¦‚ç‡
      const hasUnread = Math.random() > 0.6 // 40%æœ‰æœªè¯»æ¶ˆæ¯
      const unreadCount = hasUnread ? Math.floor(Math.random() * 20) + 1 : 0

      const item = new ItemModel(`chat_${globalIndex}`, names[globalIndex % names.length])
      item.name = names[globalIndex % names.length]
      item.lastMessage = lastMessages[globalIndex % lastMessages.length]
      item.messageType = messageTypes[Math.floor(Math.random() * messageTypes.length)]
      item.time = timeFormats[Math.floor(Math.random() * timeFormats.length)]
      item.isOnline = isOnline
      item.unreadCount = unreadCount
      item.avatar = `https://picsum.photos/100/100?random=${globalIndex}`
      item.isPinned = globalIndex < 3 // å‰3ä¸ªç½®é¡¶

      result.push(item)
    }
    return result
  }
}